{% extends "base.html" %}
{% load static %}
{% load markdown_extras %}

{% block title %}Ã‰vÃ©nements - Calculum{% endblock %}

{% block extra_head %}
<link rel="stylesheet" href="{% static 'css/events.css' %}">
<script src="{% static 'js/events.js' %}" defer></script>
{% endblock %}

{% block content %}
<div class="events-container">
	<div class="events-header">
		<h2>ğŸ‰ Ã‰vÃ©nements</h2>
		<p>Nos activitÃ©s et moments marquants</p>
	</div>
	
	{% if events %}
		{% for event in events %}
		<div class="event-card {% if forloop.first %}most-recent{% endif %}">
			<div class="event-header">
				<div>
					<h3 class="event-title">{{ event.title }}</h3>
					{% if forloop.first %}
					<span class="event-badge">RÃ©cent</span>
					{% endif %}
				</div>
				{% if event.has_active_server %}
				<a href="/events/{{ event.slug }}" class="server-button" target="_blank" rel="noopener">ğŸ–¥ï¸ Serveur Live</a>
				{% endif %}
			</div>
			
			<div class="event-body">
				{% if event.start or event.end %}
				<div class="event-dates">
					{% if event.start and event.end %}
						<span>Du {{ event.start|date:"d/m/Y" }} au {{ event.end|date:"d/m/Y" }}</span>
					{% elif event.start %}
						<span>Le {{ event.start|date:"d/m/Y" }}</span>
					{% elif event.end %}
						<span>Jusqu'au {{ event.end|date:"d/m/Y" }}</span>
					{% endif %}
				</div>
				{% endif %}
				<div class="event-summary">{{ event.summary|markdown_to_html }}</div>
				
				{% if event.medias.all %}
				<div class="event-media">
					{% for media in event.medias.all %}
					<div class="media-item">
						{% if ".mp4" in media.file.url or ".webm" in media.file.url or ".mov" in media.file.url %}
							<video controls>
								<source src="{{ media.file.url }}" type="video/mp4">
								Votre navigateur ne supporte pas la lecture de vidÃ©os.
							</video>
						{% else %}
							<img src="{{ media.file.url }}" alt="{{ event.title }}" loading="lazy">
						{% endif %}
					</div>
					{% endfor %}
				</div>
				{% endif %}
			</div>
		</div>
		{% endfor %}
	{% else %}
		<div class="no-events">
			<h3>Aucun Ã©vÃ©nement pour le moment</h3>
			<p>Les Ã©vÃ©nements apparaÃ®tront ici une fois crÃ©Ã©s.</p>
		</div>
	{% endif %}
</div>
{% endblock %}